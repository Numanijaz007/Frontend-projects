(()=>{"use strict";const e="1.8.3";let t;var n;(n=t||(t={})).IdwHydraHasErrorKey="IDW_HYDRA_HAS_ERROR",n.IdwCohortIdsKey="cohort_ids",n.idwScrollY="idw-scroll-y",n.IdwImpressionsKey="idw-impressions",n.anonymised="Anonymised",n.isOofUrl="idw-oof",n.idwOutdated="idw-outdated",n.AnonSignalLift="anon-sl",n.AnonUserSync="anon-hndshk";const o=(e,t)=>{const n=3===e;return 1===e&&"ppid"===t?8:2===e&&"pps"===t?16:n&&"ppid"===t?10:n&&"pps"===t?17:e};try{const n=document.currentScript;if(!n?.src)throw new Error("loader.js script source not found, cannot load Anonymised tag");if(window.self!==window.top)throw new Error("Anonymised tag will not start. Not running in the top frame");const i=Array.from(n.attributes),r=n.src.split("/").pop()||"";if(!r.startsWith("loader.js")&&!r.startsWith("idw_plugin_light.min.js"))throw new Error("Unexpected loader script name");let a=n.src.replace(r,"");a.includes("static.anonymised.io")&&(a=a.replace("static.anonymised.io","cdn1.anonymised.io"));const s=a+"bundle.js"+`?v=${e}`,d=a+"auth.js"+`?v=${e}`,c=Array.from(document.scripts),l=c.some((e=>e.src===s)),g=c.some((e=>e.src===d||e.src.includes("static.anonm.io")&&e.src.includes("auth.js")));if(l)throw new Error("Anonymised tag already present: bundle.js, skipping re-initialization");const u=document.createElement("script");i.forEach((e=>{u.setAttribute(e.name,e.value)})),u.setAttribute("src",s),u.onerror=()=>{console.warn("Anonymised tag: Failed to load bundle.js")};const p=document.head||document.documentElement;if(p.appendChild(u),!g){const e=document.createElement("script");e.setAttribute("src",d),e.onerror=()=>{console.warn("Anonymised tag: Failed to load auth.js")},p.appendChild(e)}window.googletag=window.googletag||{cmd:[]},window.googletag.cmd.push((()=>{try{let e=JSON.parse(window.localStorage.getItem(t.AnonSignalLift))||{};e=(e=>{if(!e?.targeting?.[0]?.value)return e;const n=100*Math.random(),i=parseInt(e.targeting[0].value,10);if(isNaN(i))return e;const r=localStorage.getItem("anon-ppid-perc"),a=r?parseFloat(r):1;if(n<=a){const n=o(i,"ppid");return console.log("AnonymisedSignalLift PPID holdout calculated:",i,n),n===i?e:{...e,cuid:void 0,targeting:[{key:t.anonymised+"SignalLift",value:n.toString()}]}}if(n<=a+1){const n=o(i,"pps");return console.log("AnonymisedSignalLift PPS holdout calculated:",i,n),n===i?e:{...e,targeting:[{key:t.anonymised+"SignalLift",value:n.toString()}],iabAudience:[]}}return e})(e),e?.cuid&&window.googletag.pubads().setPublisherProvidedId(e.cuid),e?.iabAudience&&e?.iabAudience?.length&&(window.googletag.setConfig({pps:{taxonomies:{IAB_AUDIENCE_1_1:{values:e.iabAudience}}}}),console.log("Set PPS to Google Publisher Tag",e.iabAudience)),e.targeting&&Array.isArray(e.targeting)&&e.targeting.forEach((e=>{e?.key&&void 0!==e?.value&&window.googletag.pubads().setTargeting(e.key,e.value)}))}catch(e){console.warn(`${t.AnonSignalLift} set GPT params error`,e)}}))}catch(e){console.warn("Anonymised tag: Initialization error:",e)}})();